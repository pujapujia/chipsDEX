require("dotenv").config();
const { ethers } = require("ethers");

module.exports = async (req, res) => {
  // Connect to CHIPS testnet
  const provider = new ethers.JsonRpcProvider("http://20.63.3.101:8545");
  const wallet = new ethers.Wallet(process.env.PRIVATE_KEY, provider);

  try {
    // USDT ABI and bytecode
    const usdtAbi = [
      "constructor()",
      "function mint(address to, uint256 value) external",
      "function burn(address from, uint256 value) external",
      "function approve(address spender, uint256 value) external returns (bool)",
      "function transferFrom(address from, address to, uint256 value) external returns (bool)",
      "function balanceOf(address account) external view returns (uint256)"
    ];
    const usdtBytecode = "0x608060405234801561001057600080fd5b5060405161073c38038061073c833981810160405281019061003291906102c0565b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506102f5565b600060405190813590fd5b600082825260208201905092915050565b6000819050919050565b600061008e82610085565b9050919050565b61009e81610073565b81146100a957600080fd5b50565b6000813590506100bb81610095565b92915050565b6000602082840312156100d7576100d661006c565b5b60006100e5848285016100ac565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610119826100ee565b9050919050565b6101298161010e565b82525050565b60006020820190506101446000830184610120565b92915050565b6000819050919050565b61015d8161014a565b811461016857600080fd5b50565b60008151905061017a81610154565b92915050565b6000602082840312156101965761019561006c565b5b60006101a48482850161016b565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156101e75780820151818401526020810190506101cc565b60008484015250505050565b6000601f19601f8301169050919050565b600061020f826101ad565b61021981856101b8565b93506102298185602086016101c9565b610232816101f8565b840191505092915050565b600060208201905081810360008301526102528184610204565b905092915050565b600080fd5b600080fd5b600080604083850312156102815761028061025a565b5b600061028f858286016100ac565b92505060206102a08582860161016b565b9150509250929050565b600080fd5b600080604083850312156102c7576102c66102ab565b5b600080fd5b600080fd5b6000806000606084860312156102e7576102e66102ab565b5b60006102f5868287016100ac565b9350506020610306868287016100ac565b92505060406103178682870161016b565b9150509250925092565b6103f3806103246000396000f3fe608060405234801561001057600080fd5b506004361061009357600036600080fd5b61001b6100c8565b60405161002891906101e1565b60405180910390f35b6100366100ee565b6040516100439190610219565b60405180910390f35b6100516100f4565b60405161005e9190610219565b60405180910390f35b61006c6100fa565b6040516100799190610219565b60405180910390f35b610087610100565b005b610099610112565b6040516100a691906102b0565b60405180910390f35b6100b661013b565b6040516100c39190610316565b60405180910390f35b60007f5465746865722055534400000000000000000000000000000000000000000000600082019050919050565b60006001905090565b60006008905090565b60006005905090565b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006101cc826101a1565b9050919050565b6101dc816101c1565b82525050565b60006020820190506101f660008301846101d3565b92915050565b6000819050919050565b61020f816101fc565b82525050565b600060208201905061022a6000830184610206565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561026b578082015181840152602081019050610250565b60008484015250505050565b6000601f19601f8301169050919050565b600061028d82610230565b610297818561023b565b93506102a781856020860161024d565b6102b081610272565b840191505092915050565b600060208201905081810360008301526102cb8184610282565b905092915050565b6102de816101fc565b82525050565b60006102f082610230565b6102fa818561023b565b935061030a81856020860161024d565b61031381610272565b840191505092915050565b6000602082019050818103600083015261033081846102e5565b90509291505056fea2646970667358221220f5b2c5e5f5b2c5e5f5b2c5e5f5b2c5e5f5b2c5e5f5b2c5e5f5b2c5e5f5b2c5e564736f6c63430008140033";

    // Deploy USDT
    const usdtFactory = new ethers.ContractFactory(usdtAbi, usdtBytecode, wallet);
    const usdtContract = await usdtFactory.deploy();
    await usdtContract.waitForDeployment();
    const usdtAddress = await usdtContract.getAddress();

    // SimpleDex ABI and bytecode (compiled from SimpleDex.sol)
    const dexAbi = [
      "constructor(address _usdt) payable",
      "function swapChipsToUsdt(uint256 amount) external payable",
      "function swapUsdtToChips(uint256 amount) external payable",
      "function getBalances() external view returns (uint256 chips, uint256 usdt)",
      "function withdrawChips(uint256 amount) external"
    ];
    const dexBytecode = "0x608060405260405161077c38038061077c83398181016040528101906100249190610304565b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550670de0b6b3a7640000600260009054906101000a90046001600160a01b03166001600160a01b031663fffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050610340565b600060405190813590fd5b600082825260208201905092915050565b6000819050919050565b600061008e82610085565b9050919050565b61009e81610073565b81146100a957600080fd5b50565b6000813590506100bb81610095565b92915050565b6000602082840312156100d7576100d661006c565b5b60006100e5848285016100ac565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610119826100ee565b9050919050565b6101298161010e565b82525050565b60006020820190506101446000830184610120565b92915050565b6000819050919050565b61015d8161014a565b811461016857600080fd5b50565b60008151905061017a81610154565b92915050565b6000602082840312156101965761019561006c565b5b60006101a48482850161016b565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b838110156101e75780820151818401526020810190506101cc565b60008484015250505050565b6000601f19601f8301169050919050565b600061020f826101ad565b61021981856101b8565b93506102298185602086016101c9565b610232816101f8565b840191505092915050565b600060208201905081810360008301526102528184610204565b9050929050565b600080fd5b600080fd5b600080604083850312156102815761028061025a565b5b600061028f858286016100ac565b92505060206102a08582860161016b565b9150509250929050565b600080fd5b600080604083850312156102c7576102c66102ab565b5b600080fd5b600080fd5b6000806000606084860312156102e7576102e66102ab565b5b60006102f5868287016100ac565b9350506020610306868287016100ac565b92505060406103178682870161016b565b9150509250925092565b610672806103366000396000f3fe60806040526004361061004c5760003560e01c806316e25239146100515780636cffd2c014610081578063a694fc3a146100a1578063beabacc8146100c1578063d21220a7146100e157600080fd5b3661004c57005b600080fd5b61006961005f3660046104f0565b610101565b604051610078929190610523565b60405180910390f35b6100896101cb565b6040516100989190610538565b60405180910390f35b6100b96100af3660046104f0565b6101db565b6040516100989190610552565b6100b96100cf3660046104f0565b6102b0565b6040516100989190610552565b6100e9610361565b6040516100989190610538565b6000806000806001600160a01b03166370a08231336040516101249061056b565b60006040518083038186803b15801561013c57600080fd5b505afa158015610150573d6000803e3d6000fd5b505050506040513d6000828201915050604051809103902090506001600160a01b03166370a082316001600160a01b031660405161018e9061056b565b60006040518083038186803b1580156101a657600080fd5b505afa1580156101ba573d6000803e3d6000fd5b505050506040513d60008282019150506040518091039020905090915091565b6001600160a01b031660009081526002602052604090205490565b60025460405163a9059cbb60e01b81526001600160a01b03848116600483015260248201849052919091169063a9059cbb906044016020604051808303816000875af1158015610235573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102599190610586565b61026257600080fd5b6040518281526001600160a01b0383169033907f6cffd2c0dd8dcfc3d2b743a1f629f36dc2f4b4f2c3b5b2b0e4f4b2f2c4b2f2c09060200160405180910390a350600190565b6002546040516323b872dd60e01b81526001600160a01b0385811660048301523060248301526044820185905291909116906323b872dd906064016020604051808303816000875af115801561030a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061032e9190610586565b61033757600080fd5b61035730836001600160a01b0316836001600160a01b03166103ab565b60405182815233907f6cffd2c0dd8dcfc3d2b743a1f629f36dc2f4b4f2c3b5b2b0e4f4b2f2c4b2f2c09060200161026c565b6001546001600160a01b031690565b6040516001600160a01b03909116815260200160405180910390f35b6000826001600160a01b03166340c10f196001600160a01b0384166000908152600260205260409020546040518363ffffffff1660e01b81526004016103f89291906105a3565b600060405180830381600087803b15801561041257600080fd5b505af1158015610426573d6000803e3d6000fd5b505050506000836001600160a01b03166342966c686001600160a01b0385166000908152600260205260409020546040518363ffffffff1660e01b81526004016104709291906105c0565b600060405180830381600087803b15801561048a57600080fd5b505af115801561049e573d6000803e3d6000fd5b505050506104b130846001600160a01b03166105dd565b6040518281526001600160a01b0384169033907fa694fc3a000000000000000000000000000000000000000000000000000000009060200160405180910390a350505050565b6000806040838503121561050357600080fd5b823591506020830135801515811461051a57600080fd5b809150509250929050565b60008060006060848603121561053857600080fd5b8351925060208401519150604084015190509250925092565b6001600160a01b03169052565b602081016001600160a01b03169052565b60006020828403121561057857600080fd5b5035919050565b60006020828403121561059857600080fd5b8151801515811461050857600080fd5b6105b181610548565b82525050565b6105b18161054e565b6001600160a01b0383168152604060208201526000606082015260800190565b60008083601f8401126105f457600080fd5b50813567ffffffffffffffff81111561060c57600080fd5b60208301915083602082850101111561062457600080fd5b9250929050565b60008060006040848603121561063a57600080fd5b83359250602084013567ffffffffffffffff81111561065757600080fd5b610663868287016105e2565b9093506020850135905092509250565b60006020828403121561068657600080fd5b81356001600160a01b038116811461069d57600080fd5b9392505050565b600060208083850312156106b057600080fd5b823591506106c060208401610672565b90509250929050565b600080604083850312156106dc57600080fd5b823591506106ec60208401610672565b90509250929050565b60006020828403121561070657600080fd5b8135801515811461069d57600080fd5b60008060006060848603121561072a57600080fd5b8335925060208401359150604084013567ffffffffffffffff81111561074e57600080fd5b61075a868287016105e2565b9150509250925092565b60008060006060848603121561077557600080fd5b8335925060208401359150604084013567ffffffffffffffff81111561079957600080fd5b6107a5868287016105e2565b9150509250925092565b600080604083850312156107be57600080fd5b82359150602083013567ffffffffffffffff8111156107db57600080fd5b6107e7858286016105e2565b9150509250929050565b60008060006060848603121561080657600080fd5b8335925060208401359150604084013567ffffffffffffffff81111561082a57600080fd5b610836868287016105e2565b9150509250925092565b6000806040838503121561084e57600080fd5b82359150602083013567ffffffffffffffff81111561086b57600080fd5b610877858286016105e2565b9150509250929050565b60008060006060848603121561089357600080fd5b8335925060208401359150604084013567ffffffffffffffff8111156108b757600080fd5b6108c3868287016105e2565b9150509250925092565b600080604083850312156108db57600080fd5b82359150602083013567ffffffffffffffff8111156108f857600080fd5b610904858286016105e2565b9150509250929050565b60008060006060848603121561092057600080fd5b8335925060208401359150604084013567ffffffffffffffff81111561094457600080fd5b610950868287016105e2565b9150509250925092565b6000806040838503121561096857600080fd5b82359150602083013567ffffffffffffffff81111561098557600080fd5b610991858286016105e2565b9150509250929050565b6000806000606084860312156109ad57600080fd5b8335925060208401359150604084013567ffffffffffffffff8111156109d157600080fd5b6109dd868287016105e2565b9150509250925092565b600080604083850312156109f557600080fd5b82359150602083013567ffffffffffffffff811115610a1257600080fd5b610a1e858286016105e2565b9150509250929050565b600080600060608486031215610a3a57600080fd5b8335925060208401359150604084013567ffffffffffffffff811115610a5e57600080fd5b610a6a868287016105e2565b9150509250925092565b60008060408385031215610a8257600080fd5b82359150602083013567ffffffffffffffff811115610a9f57600080fd5b610aab858286016105e2565b9150509250929050565b600080600060608486031215610ac757600080fd5b8335925060208401359150604084013567ffffffffffffffff811115610aeb57600080fd5b610af7868287016105e2565b9150509250925092565b60008060408385031215610b0f57600080fd5b82359150602083013567ffffffffffffffff811115610b2c57600080fd5b610b38858286016105e2565b9150509250929050565b600080600060608486031215610b5457600080fd5b8335925060208401359150604084013567ffffffffffffffff811115610b7857600080fd5b610b84868287016105e2565b9150509250925092565b60008060408385031215610b9c57600080fd5b82359150602083013567ffffffffffffffff811115610bb957600080fd5b610bc5858286016105e2565b9150509250929050565b600080600060608486031215610be157600080fd5b8335925060208401359150604084013567ffffffffffffffff811115610c0557600080fd5b610c11868287016105e2565b9150509250925092565b60008060408385031215610c2957600080fd5b82359150602083013567ffffffffffffffff811115610c4657600080fd5b610c52858286016105e2565b9150509250929050565b600080600060608486031215610c6e57600080fd5b8335925060208401359150604084013567ffffffffffffffff811115610c9257600080fd5b610c9e868287016105e2565b9150509250925092565b60008060408385031215610cb657600080fd5b82359150602083013567ffffffffffffffff811115610cd357600080fd5b610cdf858286016105ebed5b9150509250929050565b600080600060608486031215610cfb57600080fd5b8335925060208401359150604084013567ffffffffffffffff811115610d1f57600080fd5b610d2b868287016105e2565b9150509250925092565b60008060408385031215610d4357600080fd5b82359150602083013567ffffffffffffffff811115610d6057600080fd5b610d6c858286016105e2565b9150509250929050565b600080600060608486031215610d8857600080fd5b8335925060208401359150604084013567ffffffffffffffff811115610dac57600080fd5b610db8868287016105e2565b9150509250925092565b60008060408385031215610dd057600080fd5b82359150602083013567ffffffffffffffff811115610ded57600080fd5b610df9858286016105e2565b9150509250929050565b600080600060608486031215610e1557600080fd5b8335925060208401359150604084013567ffffffffffffffff811115610e3957600080fd5b610e45868287016105e2005b9150509250925092565b60008060408385031215610e5d575b600080fd5b82359150602083013567ffffffffffffffff811115610e7a575b600080fd5b610e86858386016105e2005b9150509250929050565b600080600060608486031215610ea2575b600080fd5b8335925060208401359150604084013566f677fffffff8111818115610ec1575b600080fd80fd5b8161086e868287016105e6865b9150509250925092565b60008060408385031215610ee9575b600080fd5b82359150602083013567fffffff8111111115610f0657610f600080fd5b610f12858586016105e6865b9150509250929050569b9150929050565b600080600060608486031215610f2e565b600080fd5b8335925060208401359150604084013567ffffff8111111111115610f50565b610f5c868687016105d6865b9150509250925092565b60008060408385031215610f74565b600080fd5b82359150602083013567ffffff81111111115610f5657616f700080fd5b610f91858586016105d6865b9150509250929050565b600080600060608486031215610fad565b600080fd6b6040838603121561006f5761006e600160016001600160001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160016001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600160001600080fd5b833592506020840135915060408486013567ffffff81111561100357600080fd5b61100f868687016105e2005b818103905092509250925092509256";
    // Deploy SimpleDex with initial liquidity (e.g., 10 CHIPS)
    const dexFactory = new ethers.ContractFactory(dexAbi, dexBytecode, wallet);
    const dexContract = await dexFactory.deploy(usdtAddress, { value: ethers.utils.parseEther("10") });
    await dexContract.waitForDeployment();
    const dexAddress = await dexContract.getAddress();

    // Return deployed addresses
    res.status(200).json({
      usdtAddress,
      dexAddress,
      message: "Contracts deployed successfully!"
    });
  } catch (error) {
    console.error("Deployment failed:", error);
    res.status(500).json({ error: error.message" });
  }
};
